<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Configura√ß√£o Mestra</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Configura√ß√£o Mestra</h1>
        <form id="configForm">
            <div class="row">
                <div class="input-group">
                    <label>Estado (Tarifa)</label>
                      <select id="selEst">
                        <option value="0.92">S√£o Paulo (R$ 0,92)</option>
                        <option value="0.98">Rio de Janeiro (R$ 0,98)</option>
                        <option value="0.85">Minas Gerais (R$ 0,85)</option>
                        <option value="0.82">Paran√° (R$ 0,82)</option>
                        <option value="0.75">Santa Catarina (R$ 0,75)</option>
                        <option value="0.88">Rio Grande do Sul (R$ 0,88)</option>
                        <option value="1.05">Bahia (R$ 1,05)</option>
                        <option value="0.95">Pernambuco (R$ 0,95)</option>
                        <option value="1.10">Par√° (R$ 1,10)</option>
                        <option value="0.90">Distrito Federal (R$ 0,90)</option>
                        <option value="outros">Inserir Manualmente</option>
                      </select>
                </div>
                <div class="input-group"><label>kWh (R$)</label><input type="number" id="energyKwh" value="0.92" step="0.01"></div>
            </div>
            <div class="field-alert"><strong>Dica:</strong> Valores m√©dios. Use o campo manual para exatid√£o total.</div>

            <hr>

            <div class="input-group">
                <label>Modelo da Impressora</label>
                <select id="selImp">
                  <optgroup label="Bambu Lab">
                    <option value="0.045">Bambu Lab - A1 Mini (45W)</option>
                    <option value="0.065">Bambu Lab - A1 (65W)</option>
                    <option value="0.070">Bambu Lab - P1P (70W)</option>
                    <option value="0.075">Bambu Lab - P1S (75W)</option>
                    <option value="0.085">Bambu Lab - X1 Carbon (85W)</option>
                  </optgroup>
                  <optgroup label="Creality">
                    <option value="0.060">Creality - Ender 3 / V2 (60W)</option>
                    <option value="0.070">Creality - Ender 3 S1 (70W)</option>
                    <option value="0.080">Creality - Ender 5 S1 (80W)</option>
                    <option value="0.100">Creality - K1 (100W)</option>
                    <option value="0.120">Creality - K1 Max (120W)</option>
                    <option value="0.090">Creality - Ender 3 V3 KE (90W)</option>
                  </optgroup>
                  <optgroup label="Anycubic">
                    <option value="0.065">Anycubic - Kobra 2 Neo (65W)</option>
                    <option value="0.080">Anycubic - Kobra 2 Pro (80W)</option>
                    <option value="0.100">Anycubic - Kobra 2 Max (100W)</option>
                  </optgroup>
                  <optgroup label="Artillery">
                    <option value="0.075">Artillery - Sidewinder X2 (75W)</option>
                    <option value="0.060">Artillery - Genius Pro (60W)</option>
                  </optgroup>
                  <optgroup label="Outras Marcas">
                    <option value="0.080">Prusa - MK3S+ / MK4 (80W)</option>
                    <option value="0.070">Kingroon - KP3S Pro (70W)</option>
                    <option value="0.110">Elegoo - Neptune 4 Pro (110W)</option>
                    <option value="0.130">Elegoo - Neptune 4 Max (130W)</option>
                  </optgroup>
                    <option value="outros">Personalizado (Manual)</option>
                </select>
            </div>
            <div class="row">
                <div class="input-group"><label>Consumo (kW)</label><input type="number" id="consumoKw" value="0.07" step="0.001"></div>
                <div class="input-group"><label>Margem (Lucro)</label><input type="number" id="margin" value="2.0" step="0.1"></div>
            </div>
            <div class="field-alert"><strong>Dica:</strong> O consumo real depende das temperaturas de mesa e bico.</div>

            <hr>

            <div class="row">
                <div class="input-group"><label>Pre√ßo Rolo (R$)</label><input type="number" id="priceFilament" value="100"></div>
                <div class="input-group"><label>Peso Rolo (g)</label><input type="number" id="weightFilament" value="1000"></div>
            </div>
            <div class="input-group"><label>Setup Fixo (R$)</label><input type="number" id="machineCost" value="10"></div>

            <div class="link-section" style="margin-top:2rem; background:#f1f5f9; padding:1.2rem; border-radius:12px;">
                <label>Link Gerado:</label>
                <textarea id="linkOutput" readonly style="resize:none; font-family:monospace; font-size:0.75rem; border:none; background:transparent; margin-bottom:1rem;"></textarea>
                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="ConfigManager.copy()">üìã Copiar</button>
                    <a id="btnGo" href="#" class="btn btn-primary" target="_blank">üöÄ Abrir</a>
                </div>
            </div>
        </form>
    </div>

    <script src="app.js"></script>
    <script>
        const ConfigManager = {
            init() {
                const form = document.getElementById('configForm');
                form.addEventListener('input', (e) => this.handleInput(e));
                this.generate();
            },

            handleInput(e) {
                if(e.target.id === 'selEst' && e.target.value !== 'outros') document.getElementById('energyKwh').value = e.target.value;
                if(e.target.id === 'selImp' && e.target.value !== 'outros') document.getElementById('consumoKw').value = e.target.value;
                this.generate();
            },

            generate() {
                const priceFil = parseFloat(document.getElementById('priceFilament').value) || 0;
                const weightFil = parseFloat(document.getElementById('weightFilament').value) || 1000;
                
                const data = {
                    priceKg: ((priceFil / weightFil) * 1000).toFixed(2),
                    energyKwh: document.getElementById('energyKwh').value,
                    machineCost: document.getElementById('machineCost').value,
                    margin: document.getElementById('margin').value,
                    consumoKw: document.getElementById('consumoKw').value
                };

                const url = window.location.href.replace('config.html', 'index.html') + '?data=' + AppEngine.encodeData(data);
                document.getElementById('linkOutput').value = url;
                document.getElementById('btnGo').href = url;
            },

            copy() {
                const output = document.getElementById('linkOutput');
                output.select();
                document.execCommand('copy');
                alert("Link copiado com sucesso!");
            }
        };

        window.onload = () => ConfigManager.init();
    </script>
</body>
</html>
